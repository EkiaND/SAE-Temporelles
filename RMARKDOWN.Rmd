---
title: |
       | Analyse des séries temporelles
author: 
  - Rasmata Sawadogo - Courteney Saint-Hubert - Sidy Diop - Romain Lesueur
date: "`r format(Sys.time(),'%d %B %Y')`"
fontsize: 11pt
documentclass: "article"
header-includes:
- \usepackage{float} # Ces deux commandes permettent d'éviter que les images soient en float
- \floatplacement{figure}{H}
output: 
  pdf_document:
    number_section: true
    fig_caption: true
    toc: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE,
	fig.width = 8,
	fig.height = 5,
	out.width = "95%",
	fig.align = "center"
)
```

\newpage

```{r libraries, results='hide'}
# Liste des librairies nécessaires
libraries <- c("tabulapdf", "tidyverse", "dplyr", "data.table", "ggplot2", "lubridate")

# Fonction pour installer les librairies manquantes
install_if_missing <- function(libs) {
  for (lib in libs) {
    if (!require(lib, character.only = TRUE)) {
      install.packages(lib, dependencies = TRUE)
      library(lib, character.only = TRUE)
    }
  }
}

# Installation des librairies manquantes
install_if_missing(libraries)
```

```{r dataset, results='hide'}
# Extraction des données des fichiers PDF
café_data <- extract_tables("Futures café US C - Données Historiques.pdf",
                            method = "decide", 
                            encoding = "UTF-8",
                            col_names = FALSE,
                            dec = ",",
                            output = "tibble")

cacao_data <- extract_tables("Futures cacao US - Données Historiques.pdf",
                             method = "decide", 
                             encoding = "UTF-8",
                             col_names = FALSE,
                             output = "tibble")

jus_orange_data <- extract_tables("Futures jus dorange - Données Historiques.pdf",
                                  method = "decide", 
                                  encoding = "UTF-8",
                                  col_names = FALSE,
                                  output = "tibble")

sucre_data <- extract_tables("Futures sucre Londres - Données Historiques.pdf",
                             method = "decide", 
                             encoding = "UTF-8",
                             col_names = FALSE,
                             output = "tibble")

petrol_data <- extract_text("Futures pétrole Brent - Données Historiques.pdf")
```

```{r data_processing, results='hide'}
# Combinaison et traitement des tables pour chaque produit

# Pour le café
data_cafe <- as_tibble(rbindlist(café_data, fill = TRUE)) %>%
  rename(
    Date = X1, 
    Closed_Cotation = X2, 
    Opened_Cotation = X3, 
    Highest_Cotation = X4, 
    Lowest_Cotation = X5
  ) %>%
  mutate(
    Date = as.Date(Date, format = "%d/%m/%Y"),
    Closed_Cotation = round(as.numeric(gsub(",", ".", Closed_Cotation))/100, 2),
    Opened_Cotation = round(as.numeric(gsub(",", ".", Opened_Cotation))/100, 2),
    Highest_Cotation = round(as.numeric(gsub(",", ".", Highest_Cotation))/100, 2),
    Lowest_Cotation = round(as.numeric(gsub(",", ".", Lowest_Cotation))/100, 2)
  )

# Pour le cacao
data_cacao <- as_tibble(rbindlist(cacao_data, fill = TRUE)) %>%
  rename(
    Date = X1, 
    Closed_Cotation = X2, 
    Opened_Cotation = X3, 
    Highest_Cotation = X4, 
    Lowest_Cotation = X5
  ) %>%
  mutate(
    Date = as.Date(Date, format = "%d/%m/%Y"),
    Closed_Cotation = round(as.numeric(gsub(",", ".", gsub("\\.", "", Closed_Cotation))), 2),
    Opened_Cotation = round(as.numeric(gsub(",", ".", gsub("\\.", "", Opened_Cotation))), 2),
    Highest_Cotation = round(as.numeric(gsub(",", ".", gsub("\\.", "", Highest_Cotation))), 2),
    Lowest_Cotation = round(as.numeric(gsub(",", ".", gsub("\\.", "", Lowest_Cotation))), 2)
  )%>%
  drop_na()


# Pour le jus d'orange
data_jus_orange <- as_tibble(rbindlist(jus_orange_data, fill = TRUE)) %>%
  rename(Date = X1, 
         Closed_Cotation = X2, 
         Opened_Cotation = X3, 
         Highest_Cotation = X4, 
         Lowest_Cotation = X5) %>%
  mutate(
    Date = as.Date(Date, format = "%d/%m/%Y"),
    Closed_Cotation = round(as.numeric(gsub(",", ".", gsub("\\.", "", Closed_Cotation))), 2),
    Opened_Cotation = round(as.numeric(gsub(",", ".", gsub("\\.", "", Opened_Cotation))), 2),
    Highest_Cotation = round(as.numeric(gsub(",", ".", gsub("\\.", "", Highest_Cotation))), 2),
    Lowest_Cotation = round(as.numeric(gsub(",", ".", gsub("\\.", "", Lowest_Cotation))), 2)
  )

# Pour le sucre
data_sucre <- as_tibble(rbindlist(sucre_data, fill = TRUE)) %>%
  rename(Date = X1, 
         Closed_Cotation = X2, 
         Opened_Cotation = X3, 
         Highest_Cotation = X4, 
         Lowest_Cotation = X5) %>%
  mutate(
    Date = as.Date(Date, format = "%d/%m/%Y"),
    Closed_Cotation = round(as.numeric(gsub(",", ".", gsub("\\.", "", Closed_Cotation))), 2),
    Opened_Cotation = round(as.numeric(gsub(",", ".", gsub("\\.", "", Opened_Cotation))), 2),
    Highest_Cotation = round(as.numeric(gsub(",", ".", gsub("\\.", "", Highest_Cotation))), 2),
    Lowest_Cotation = round(as.numeric(gsub(",", ".", gsub("\\.", "", Lowest_Cotation))), 2)
  )

# Pour le pétrole

# Diviser les données en lignes
lines <- unlist(strsplit(petrol_data, "\n"))

# Filtrer les lignes contenant "Page" ou "Futures pétrole Brent" et les ignorer
lines_cleaned <- lines[!grepl("Page|Futures pétrole Brent", lines)]

# Filtrer les lignes contenant des dates 
data_lines <- lines[str_detect(lines, "^[0-9]{2}/[0-9]{2}/[0-9]{4}")]

# Séparer les colonnes en utilisant des espaces multiples comme séparateurs
split_data <- str_split(data_lines, "\\s+", simplify = TRUE)

# Ajouter des noms de colonnes
colnames(split_data) <- c("Date", "Closed_Cotation", "Opened_Cotation", "Highest_Cotation", "Lowest_Cotation", "Random")

# Convertir en tibble
split_data_tibble <- as_tibble(split_data)

# Transformation des colonnes
data_petrol <- split_data_tibble %>%
  mutate(
    Date = as.Date(Date, format = "%d/%m/%Y"),
    Closed_Cotation = round(as.numeric(gsub(",", ".", Closed_Cotation)), 3),
    Opened_Cotation = round(as.numeric(gsub(",", ".", Opened_Cotation)), 3),
    Highest_Cotation = round(as.numeric(gsub(",", ".", Highest_Cotation)), 3),
    Lowest_Cotation = round(as.numeric(gsub(",", ".", Lowest_Cotation)), 3)
  )


# Fusion de toutes les données en un seul dataset
dataset <- bind_rows(
  data_cafe %>% mutate(Product = "Café"),
  data_cacao %>% mutate(Product = "Cacao"),
  data_jus_orange %>% mutate(Product = "Jus d'Orange"),
  data_sucre %>% mutate(Product = "Sucre"),
  data_petrol %>% mutate(Product = "Pétrole")
)
dataset <- dataset %>% mutate(Product = as.factor(Product))


# Affichage des premières lignes pour vérification
head(dataset)
str(dataset)
colnames(dataset)
```

# Introduction

"Les séries temporelles, autrement dit 'l’observation de variables quantitatives indexées par le temps', jouent un rôle crucial dans l’analyse de phénomènes évolutifs." (Source : [Investing.com](https://www.investing.com/)). Que ce soit dans la santé, l'environnement, les transports, ou surtout le domaine financier, ces données permettent d’interpréter et de prévoir des tendances clés. Parmi ces domaines, les cotations des matières premières constituent une source riche d’informations pour comprendre les fluctuations du marché. 

Dans ce projet, nous avons choisi de travailler sur les données historiques (2010-2023) des cotations de cinq matières premières : le café, le cacao, le jus d’orange, le sucre, et le pétrole Brent, collectées depuis le site [Investing.com](https://www.investing.com/). Ces données, disponibles sous forme de fichiers PDF, permettent d'explorer diverses dimensions, comme les variations quotidiennes des prix de fermeture, les tendances mensuelles et les corrélations éventuelles entre matières premières. 

Cela soulève plusieurs questions importantes :
\begin{itemize}
  \item Comment les prix de ces matières premières ont-ils évolué depuis 2010 ?  
  \item Existe-t-il des schémas saisonniers ou des ruptures de tendance dans ces séries temporelles ?  
  \item Peut-on observer une corrélation significative entre le cacao et le café, ou entre d'autres matières premières ?  
  \item À quoi pourrait ressembler l’évolution future de ces prix sur une période de deux ans ?  
\end{itemize}

\noindent Ces interrogations guideront notre analyse, qui sera structurée en plusieurs étapes : une exploration des données, une étude des tendances et des composantes saisonnières, ainsi que des prévisions pour les mois à venir.


\newpage

# Analyse exploratoire

```{r boxplots_annuels, results='hide'}
# Boxplots annuels des cotations journalières fermées par produit

# Ajout d'une colonne pour l'année à partir de la date et suppression des NA
dataset <- dataset %>% 
  mutate(Year = as.integer(format(Date, "%Y"))) %>% 
  filter(!is.na(Year))

# Création des titres personnalisés pour les facettes
product_labels <- c(
  "Café" = "Cotation du Café",
  "Cacao" = "Cotation du Cacao",
  "Jus d'Orange" = "Cotation du Jus d'Orange",
  "Sucre" = "Cotation du Sucre",
  "Pétrole" = "Cotation du Pétrole"
)

# Création des boxplots 
ggplot(dataset, aes(x = as.factor(Year), y = Closed_Cotation, fill = Product)) +
  geom_boxplot(
    color = "black",           
    outlier.color = "black",   
    outlier.size = 1          
  ) +
  facet_wrap(
    ~ Product, 
    scales = "free_y", 
    labeller = labeller(Product = product_labels)
  ) +
  labs(
    title = "Boxplots annuels des cotations journalières fermées par produit",
    x = "Année",
    y = "Closed Cotation",
    fill = "Produit",
    subtitle = "source : Investing.com",
    caption = c("BUT Science des données - Lisieux", "Auteurs : Rasmata, Romain, Sidy ,Courteney")
  ) +
  theme_bw() +  
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),     
    strip.text = element_text(face = "bold", size = 10),  
    panel.grid.major.y = element_line(color = "gray90"),  
    legend.position = "none",                             
    plot.title = element_text(face = "bold", hjust = 0.5),
    plot.caption = element_text(hjust = c(0,1), size = 10, face = "bold", color = "black"),
    plot.subtitle = element_text(size = 12, color = "darkblue", hjust = 0.5) 
  )
```

L’analyse des boxplots annuels des cotations journalières pour chaque matière première révèle des dynamiques spécifiques et des tendances distinctes.

Le marché du cacao montre une stabilité générale avec des fluctuations modérées, mais certains points atypiques, notamment au-dessus de 30 000, peuvent être attribués à des événements exceptionnels. Ces pics sont principalement dus à des crises géopolitiques ou des crises sociales dans les pays producteurs (notamment la Côte d'Ivoire et le Ghana), mais aussi à des anomalies climatiques affectant la production. 

Le café présente une tendance haussière claire depuis 2020, accompagnée d’une augmentation de la dispersion. Cela suggère des fluctuations importantes liées à des chocs d'offre ou de demande, dus en grande partie aux conditions climatiques extrêmes affectant les principaux pays producteurs, notamment le Brésil. En outre, la pandémie de COVID-19 a perturbé les chaînes d'approvisionnement, contribuant à une hausse des prix et une volatilité accrue sur le marché. 

Le jus d’orange affiche une hausse marquée à partir de 2020, indiquant des perturbations dues principalement a des perturbations causées par des facteurs climatiques défavorables au Brésil, le plus grand producteur mondial. La sécheresse et les maladies des agrumes ont considérablement réduit la production, entraînant une pression à la hausse sur les prix. 

Les cotations du pétrole montrent une grande volatilité, avec un pic notable entre 2010 et 2012, en raison de facteurs géopolitiques tels que la guerre en Libye et les tensions au Moyen-Orient. Une forte remontée a eu lieu à partir de 2020, en réponse à une reprise économique post-COVID, couplée à des décisions de l'OPEP+ de réduire la production pour soutenir les prix, ainsi qu'à des tensions géopolitiques liées à la guerre en Ukraine, qui ont perturbé les approvisionnements mondiaux. 

Enfin, Le sucre suit une trajectoire en "U", avec une baisse significative jusqu’en 2018, en raison d’une surproduction mondiale et de la baisse des prix. À partir de 2020, les prix ont commencé à remonter progressivement, principalement en raison du COVID-19. 

En résumé, bien que chaque matière première suive une dynamique propre influencée par des facteurs spécifiques tels que les conditions climatiques, les enjeux géopolitiques et les cycles de production, un point commun notable entre toutes ces matières premières est l'augmentation des prix observée à partir de 2020. Cette hausse générale peut être attribuée aux perturbations mondiales causées par la pandémie de COVID-19, qui a affecté les chaînes d'approvisionnement, modifié les comportements de consommation et entraîné une pression accrue sur la production.

\newpage

```{r evolution_moyenne_mensuelle, results='hide'}
# Évolution moyenne mensuelle des cotations de clôture par matière première

# Création du dataset mensuel
données_mensuelles <- dataset %>% 
  mutate(Mois = floor_date(Date, "month")) %>% 
  group_by(Product, Mois) %>% 
  summarise(Moyenne_Cotation = mean(Closed_Cotation, na.rm = TRUE))

# Création du graphique de l'évolution moyenne mensuelle
ggplot(données_mensuelles, aes(x = Mois, y = Moyenne_Cotation)) +
  geom_line(alpha = 0.9, color = "#8BB92D", size = 1) +  
  geom_smooth(method = "loess", span = 0.3,se = FALSE, color = 'black') +  
  facet_wrap(~ Product, scales = "free_y",labeller = labeller(Product = product_labels)
) +  
  theme_bw() +  
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.spacing = unit(1, "lines"),
    panel.grid.major = element_line(color = "grey90"),
    panel.grid.minor = element_line(color = "grey90"),
    plot.caption = element_text(hjust = c(0,1), size = 10, face = "bold", color = "black"),
    plot.subtitle = element_text(size = 12, color = "darkblue", hjust = 0.5)
  ) +
  labs(
    title = "Évolution moyenne mensuelle des cotations de clôture par matière première",
    x = "Date",
    y = "Cotation moyenne mensuelle",
    subtitle = "source : Investing.com",
    caption = c("BUT Science des données - Lisieux", "Auteurs : Rasmata, Romain, Courteney,Sidy")
  )
```

Le graphique illustre les variations mensuelles du taux d'évolution des cotations fermées pour différentes matières premières. 

Le cacao montre de fortes fluctuations, avec des pics atteignant +80 % et des creux proches de -40 %, traduisant une grande sensibilité aux aléas climatiques et à la demande mondiale, bien que sa tendance soit légèrement croissante.

 Le café, moins volatile, présente des variations modérées entre -10 % et +30 %, avec une tendance également croissante, reflétant une relative stabilité de l’offre et de la demande. 

Le jus d’orange, quant à lui, affiche une nette augmentation après 2020, probablement liée à des perturbations climatiques et à une demande accrue pour des produits sains post-COVID-19.

 Le pétrole, fortement impacté par la pandémie, connaît une chute spectaculaire autour de 2020, suivie d’une reprise graduelle, traduisant une légère tendance haussière dans un contexte de reprise économique mondiale. Enfin, le sucre, bien que sujet à des variations modérées, présente une tendance légèrement croissante, influencée par une demande industrielle stable et des facteurs saisonniers. 

Globalement, une tendance croissante est perceptible pour la plupart des matières premières, bien que la volatilité varie selon leur sensibilité aux facteurs climatiques, économiques et sociaux.

\newpage

```{r taux_evolution_mensuel, results='hide'}
# Évolution de la moyenne mensuelle de la cotation journalière selon la matière première 

données_mensuelles <- données_mensuelles %>% 
  group_by(Product) %>% 
  arrange(Mois) %>% 
  mutate(
    Taux_Evolution = (Moyenne_Cotation - lag(Moyenne_Cotation)) / lag(Moyenne_Cotation) * 100
  ) %>% 
  ungroup()

# Création des titres personnalisés pour les facettes
product_labels2 <- c(
  "Café" = "Variation du café",
  "Cacao" = "Variation du cacao",
  "Jus d'Orange" = "Variation du jus d'orange",
  "Sucre" = "Variation du sucre",
  "Pétrole" = "Variation du pétrole"
)

# Création du graphique
ggplot(données_mensuelles, aes(x = Mois, y = Taux_Evolution, color = Product)) +
  geom_line(alpha = 0.9, color="deepskyblue1",size = 0.5) +  # Ligne pour visualiser les variations
  geom_smooth(method = "loess", se = TRUE, color='black',span=0.7,method.args=list(degree=1)) +  # Ligne pour indiquer 0%
  facet_wrap(~ Product, scales = "free_y",labeller = labeller(Product = product_labels2)
) +  # Une facette par produit
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
        axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none",
        plot.caption = element_text(hjust = c(0,1), size = 10, face = "bold", color = "black"),
        plot.subtitle = element_text(size = 12, color = "darkblue", hjust = 0.5)
  ) +
  theme_bw() +  
  labs(title = "Taux d'évolution mensuel des cotations fermées par matière première",
       subtitle = "Analyse basée sur les moyennes mensuelles",
       x = "Mois", y = "Taux d'évolution (%)",
       caption = c("BUT Science des données - Lisieux", "Auteurs : Rasmata, Romain, Courteney,Sidy")
  )
```

ANALYSE 2

L’analyse de l’évolution moyenne mensuelle des cotations journalières des matières premières révèle des dynamiques distinctes mais partagent une tendance générale de hausse des prix à partir de 2020. 

La cotation du cacao montre une stabilité relative jusqu’en 2020, suivie d’une forte augmentation. Cette hausse peut être attribuée à des perturbations sur le marché, notamment une offre limitée et une demande accrue. Des facteurs tels que des conditions climatiques défavorables dans les pays producteurs et des crises géopolitiques ont contribué à cette dynamique. La pandémie de COVID-19 a également perturbé les chaînes d'approvisionnement, entraînant des retards de paiement et des difficultés pour les producteurs. (source : oiko credit)

Le café présente une volatilité marquée tout au long de la période, avec une reprise nette depuis 2020 . Cette tendance est en grande partie due à des problèmes d'approvisionnement, exacerbés par des conditions climatiques extrêmes dans les principaux pays producteurs, notamment le Brésil et le Vietnam. La pandémie a également perturbé les chaînes d'approvisionnement, contribuant à une hausse des prix et à une volatilité accrue sur le marché. (source : ico)

Le jus d'orange, initialement stable, connaît une forte hausse à partir de 2020. Cette augmentation est principalement liée à des perturbations causées par des conditions climatiques extrêmes et des problèmes de production, notamment des sécheresses et des maladies des agrumes au Brésil, le plus grand producteur mondial. La pandémie a également perturbé la production et la distribution du jus d'orange, contribuant à une hausse des prix.( source : LSA conso)

Pour le pétrole, les fluctuations cycliques sont évidentes, avec des pics notables en 2011 et 2022 et des baisses dues à des crises économiques ou sanitaires, notamment en 2020.Une reprise progressive des prix est observée depuis 2021, en lien avec la relance économique post-COVID et des décisions de l'OPEP+ de réduire la production pour soutenir les prix. 

Enfin, la cotation du sucre suit des cycles réguliers avec une remontée depuis 2019. La pandémie a perturbé les chaînes d'approvisionnement et la production de sucre, contribuant à une volatilité des prix.

 Globalement, la hausse des prix depuis 2020, visible pour la plupart des matières premières, peut être attribuée à des facteurs mondiaux tels que les crises géopolitiques, les changements climatiques, et la reprise économique post-pandémie, bien que chaque produit soit influencé par des dynamiques spécifiques liées à son marché.

\newpage

```{r association_cafe_cacao, results='hide'}
# Association existant entre le café et le cacao

# Préparation des données
moyennes_cafe <- dataset %>% 
  filter(Product == "Café") %>% 
  mutate(Mois = floor_date(Date, "month")) %>% 
  group_by(Mois) %>% 
  summarise(Moyenne_Cafe = mean(Closed_Cotation, na.rm = TRUE))

moyennes_cacao <- dataset %>% 
  filter(Product == "Cacao") %>% 
  mutate(Mois = floor_date(Date, "month")) %>% 
  group_by(Mois) %>% 
  summarise(Moyenne_Cacao = mean(Closed_Cotation, na.rm = TRUE))

# Fusion des données
association_data <- inner_join(moyennes_cafe, moyennes_cacao, by = "Mois")

# Calcul des limites pour le café
IQR_cafe <- IQR(association_data$Moyenne_Cafe, na.rm = TRUE)
limites_cafe <- quantile(association_data$Moyenne_Cafe, c(0.25, 0.75), na.rm = TRUE) + c(-1.5, 1.5) * IQR_cafe

# Calcul des limites pour le cacao
IQR_cacao <- IQR(association_data$Moyenne_Cacao, na.rm = TRUE)
limites_cacao <- quantile(association_data$Moyenne_Cacao, c(0.25, 0.75), na.rm = TRUE) + c(-1.5, 1.5) * IQR_cacao

# Filtrer les valeurs atypiques
outliers <- association_data %>% 
  filter(
    Moyenne_Cafe < limites_cafe[1] | Moyenne_Cafe > limites_cafe[2] |
    Moyenne_Cacao < limites_cacao[1] | Moyenne_Cacao > limites_cacao[2]
  )

# Modèle de régression linéaire simple
modele <- lm(Moyenne_Cacao ~ Moyenne_Cafe, data = association_data)
summary(modele)

# Extraction des coefficients du modèle
intercept <- round(coef(modele)[1], 4) 
slope <- round(coef(modele)[2], 4)     
equation <- paste0("Moyenne_Cacao = ", intercept, " + ", slope, " * Moyenne_Cafe") 

# Diagramme de dispersion et corrélation
ggplot(association_data, aes(x = Moyenne_Cafe, y = Moyenne_Cacao)) +
  geom_point(color = "blue", size = 0.5) + 
  geom_point(data = outliers, aes(x = Moyenne_Cafe, y = Moyenne_Cacao), color = "blue", size = 0.7) + 
  geom_text(
    data = outliers, 
    aes(x = Moyenne_Cafe, y = Moyenne_Cacao, label = format(Mois, "%b %Y")), 
    color = "black", 
    size = 3, 
    hjust = 0, 
    vjust = -1
  ) +
  geom_smooth(method = "loess", se = TRUE, color = "black") + 
  labs(
    title = "Étude de l'association entre les cotations de fermeture moyennes du café et du cacao",
    x = "Moyenne mensuelle du Café",
    y = "Moyenne mensuelle du Cacao",
    subtitle = "source : Investing.com",
    caption = c("BUT Science des données - Lisieux", "Auteurs : Rasmata, Romain, Courteney,Sidy")
  ) +
  annotate("text", 
           x = min(association_data$Moyenne_Cafe), 
           y = max(association_data$Moyenne_Cacao), 
           label = equation, 
           color = "brown1", 
           hjust = 0, 
           vjust = 1, 
           size = 3) + 
  theme_minimal() +
  theme(
    plot.caption = element_text(hjust = c(0,1), size = 10, face = "bold", color = "black"),
    plot.subtitle = element_text(size = 12, color = "darkblue", hjust = 0.5),
    plot.title = element_text(hjust = 0.5, face = "bold")
  )

# Corrélation
correlation <- cor(association_data$Moyenne_Cafe, association_data$Moyenne_Cacao, use = "complete.obs")
cat("Coefficient de corrélation :", correlation, "\n")

# Coefficient de détermination
R2 <- summary(modele)$r.squared
cat("Coefficient de détermination (R^2) :", R2, "\n")
```

L’analyse des données concernant l’association entre les cotations moyennes mensuelles du café et du cacao révèle plusieurs éléments intéressants, bien que la relation entre ces deux variables soit relativement modérée.

Tout d'abord, l'existence de données atypiques, notamment en mars, avril et septembre 2024, suggère que des événements exceptionnels ont pu perturber les marchés du cacao, tels que des conditions climatiques extrêmes ou des tensions géopolitiques, affectant la production ou la demande de manière ponctuelle. Par exemple, des sécheresses sévères et des vagues de chaleur ont affecté les principales régions productrices de cacao, notamment la Côte d'Ivoire et le Ghana, réduisant la production et augmentant les prix. (source = agenceecofin.com)

En ce qui concerne l'association entre les cotations, la courbe de régression lissée indique une relation positive, ce qui signifie que lorsque les prix du café augmentent, les prix du cacao tendent également à augmenter. Cependant, l'intensité de cette relation est modérée, comme le montre un coefficient de corrélation de 40,05 %, et le coefficient de détermination de 16,04 % révèle que seulement 16 % des variations des prix du cacao peuvent être expliquées par les variations des prix du café. En d’autres termes, les autres facteurs influençant les prix du cacao sont loin d’être négligeables.

Le test d’hypothèse, avec une valeur p extrêmement faible (3,04e-08), confirme la signification statistique de la relation linéaire entre les deux variables, bien qu’elle soit modeste. L’équation de régression des moindres carrés, **Moyenne_Cacao = 988,9941 + 10,6538 × Moyenne_Café**, montre que pour chaque augmentation d’une unité de la cotation du café, celle du cacao augmente de 10,65 unités.

Globalement, bien qu'une association positive entre les deux produits soit détectée, elle reste faible, suggérant que d'autres variables influencent plus directement les prix du cacao. De plus, l'existence de données atypiques indique qu’une exploration plus approfondie de ces anomalies serait nécessaire pour comprendre leur impact sur l'association et les prix des matières premières en général. 


\newpage

```{r analyse_brent, results='hide'}
# ANALYSE DU BRENT 
#1.

# Filtrer pour le Brent et calculer les moyennes mensuelles
brent_data <- dataset %>%
  filter(Product == "Pétrole") %>%
  mutate(Mois = floor_date(Date, "month")) %>%
  group_by(Mois) %>%
  summarise(Moyenne_Brent = mean(Closed_Cotation, na.rm = TRUE))


# Visualisation globale
ggplot(brent_data, aes(x = Mois, y = Moyenne_Brent)) +
  geom_line(color = "#8B4513", size = 0.8) +  
  geom_smooth(method = "loess", span = 0.3, se = FALSE, color = "#FF0000", size = 1) +  # Rouge et lissage ajusté
  labs(
    title = "Évolution mensuelle moyenne de la cotation journalière du Brent",
    x = "Date",
    y = "Moyenne mensuelle (USD)",
    subtitle = "source : Investing.com",
    caption = c("BUT Science des données - Lisieux", "Auteurs : Rasmata, Romain, Courteney,Sidy")
  ) +
  theme_minimal()+
  theme(
    plot.caption = element_text(hjust = c(0,1), size = 10, face = "bold", color = "black"),
    plot.subtitle = element_text(size = 12, color = "darkblue", hjust = 0.5),
    plot.title = element_text(hjust = 0.5, face = "bold")
  )
```

L'analyse de l'évolution de la cotation mensuelle moyenne du Brent depuis 2010 révèle des fluctuations significatives influencées par des facteurs géopolitiques et économiques mondiaux. 

De 2010 à 2014, les prix connaissent une **croissance soutenue**, culminant à prés de 125 USD par baril, soutenue par une forte demande mondiale et la reprise économique post-2008. 

Cependant, une chute s’observe entre 2014 et 2016, les prix tombant sous 50 USD en raison d'une surproduction, notamment par les États-Unis, et d'un ralentissement économique en Chine, exacerbés par la décision de l’OPEP de maintenir sa production.

 Entre 2016 et 2020, une stabilisationdes prix est observée, oscillant entre 50 et 75 USD, en réponse aux réductions de production de l’OPEP, bien que la pandémie de COVID-19 ait provoqué un **effondrement brutal** des prix en 2020, dû à la chute de la demande mondiale.

La période suivante, de 2021 à 2023, marque une forte **remontée des prix**, dépassant **100 USD**, attribuée à la reprise économique post-COVID, à la tension géopolitique (guerre en Ukraine) et à une offre contrainte. Enfin, entre 2023 et 2025, une légère **baisse** est observée, suggérant une stabilisation des prix après des ajustements du marché. Le marché du Brent se caractérise par des cycles de **hausses et de baisses** dues à des chocs externes, avec une tendance générale à l’instabilité, bien que des signes de stabilisation apparaissent dans les dernières années.

\newpage


```{r analyse_brent_2, results='hide'}
#2. diagramme des saisonnalités

# Ajouter des colonnes pour l'année et le mois
brent_data <- brent_data %>%
  mutate(
    Annee = year(Mois),
    Mois_simple = factor(month(Mois), levels = 1:12, labels = month.abb)
  )

# Calcul des moyennes mensuelles par année
saisonnalite_annee <- brent_data %>%
  group_by(Annee, Mois_simple) %>%
  summarise(Moyenne_Brent = mean(Moyenne_Brent, na.rm = TRUE)) %>%
  ungroup()


# Graphique des saisonnalités avec courbes par année
ggplot(saisonnalite_annee, aes(x = Mois_simple, y = Moyenne_Brent, color = factor(Annee), group = Annee)) +
  geom_line(size = 1) +  
  labs(
    title = "Saisonnalité des moyennes mensuelles de la cotation du Brent",
    x = "Mois de l'année",
    y = "Moyenne mensuelle (USD)",
    color = "Année",
    subtitle = "source : Investing.com",
    caption = c("BUT Science des données - Lisieux", "Auteurs : Rasmata, Romain, Courteney,Sidy")
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.grid.major = element_line(color = "grey90"),
    plot.caption = element_text(hjust = c(0,1), size = 10, face = "bold", color = "black"),
    plot.subtitle = element_text(size = 12, color = "darkblue", hjust = 0.5),
  )
```

L'analyse des saisonnalités des cotations mensuelles du Brent montre qu'il n'existe pas de composante saisonnière régulière. En effet, les variations mensuelles des prix diffèrent considérablement d'une année à l'autre, avec des pics et des creux qui ne se produisent pas systématiquement aux mêmes mois. Par exemple, bien que les mois d'été (juin à août) montrent parfois des hausses modérées (comme en 2011, 2012, 2022), cette tendance n'est pas constante d'une année à l'autre. Les mois de janvier à mars présentent une certaine stabilité, bien que des baisses marquées aient été observées en 2020 et 2021. De même, les mois d'octobre à décembre présentent des fluctuations importantes, sans tendance claire. L'absence de saisonnalité est due à l'influence plus importante de facteurs externes, tels que des événements géopolitiques, des chocs d'offre et de demande, ainsi que des fluctuations économiques mondiales, plutôt qu'à des cycles saisonniers propres au marché du pétrole. En comparaison avec d'autres marchés où la demande est dictée par les saisons, le marché du Brent est influencé par des éléments plus structurels, comme les décisions des producteurs et les crises économiques mondiales. Ainsi, les prix du Brent sont soumis à des fluctuations exogènes, et non à une composante saisonnière marquée.

\newpage

```{r analyse_brent_3, results='hide'}
#3.

# Filtrer pour les données depuis 2020
brent_2020 <- brent_data %>%
  filter(Mois >= as.Date("2020-01-01"))

# Visualisation avec régression lissée de 2020 à la fin
ggplot(brent_2020, aes(x = Mois, y = Moyenne_Brent)) +
  geom_line(color = "blue", size = 0.8) +
  geom_smooth(method = "loess", span = 0.3, se = FALSE, color = "red", size = 0.8) +
  scale_x_date(
    breaks = seq(from = as.Date("2020-06-01"), 
                 to = max(brent_2020$Mois), 
                 by = "6 months"),
    date_labels = "%B %Y",
    name = "Mois de l'année"
  ) +
  labs(
    title = "Comportement de la moyenne mensuelle de cotation journalière du Brent depuis le 1er janvier 2020 ",
    subtitle = "source : Investing.com",
    caption = c("BUT Science des données - Lisieux", "Auteurs : Rasmata, Romain, Courteney,Sidy")
  ) +
  
  theme_minimal() +
  theme(
    panel.grid.minor = element_blank(),
    axis.text.x = element_text(angle = 0),
    panel.grid.major = element_line(color = "#E5E5E5"),
    axis.title.y = element_blank(),
    plot.caption = element_text(hjust = c(0,1), size = 10, face = "bold", color = "black"),
    plot.subtitle = element_text(size = 12, color = "darkblue", hjust = 0.5),
    plot.title = element_text(hjust = 0.5, face = "bold")
  )
```

L'analyse du comportement de la moyenne mensuelle des cotations journalières du Brent depuis 2020, avec une courbe de régression lissée, révèle plusieurs phases marquantes. Dès le début de 2020, une forte baisse des prix est observée, culminant en avril-mai, en raison du choc lié à la crise du COVID-19 et à la réduction drastique de la demande mondiale. À partir de 2020, une reprise significative commence, suivie d'une tendance haussière jusqu'à atteindre un pic en mi-2022. Cette hausse est en grande partie alimentée par la reprise économique post-pandémie, couplée à des tensions géopolitiques, notamment la guerre en Ukraine. Cependant, après mi-2022, la courbe lissée montre une stabilisation des prix, suivie d'une légère tendance baissière jusqu'en 2024. Cette diminution semble être le résultat d'une régulation du marché, d'une demande modérée et d'ajustements de l'offre, suggérant une normalisation des prix après la volatilité causée par la pandémie et les événements géopolitiques. La courbe de régression lissée permet ainsi de mieux visualiser cette dynamique, mettant en évidence une tendance à la stabilisation des prix après une période de forte volatilité.

\newpage

```{r analyse_brent_4, results='hide'}
#4.

# Définir t1 et t2 en termes de Year_Month
t1 <- 2022 + 6 / 12 
t2 <- 2023 + 6 / 12 
brent_2020 <- brent_2020 %>%
  mutate(
    Year_Month = as.numeric(format(Mois, "%Y")) + as.numeric(format(Mois, "%m")) / 12,
    Var_t1 = pmax(0, Year_Month - t1), 
    Var_t2 = pmax(0, Year_Month - t2)  
  )
# Ajuster le modèle
model <- lm(Moyenne_Brent ~ Year_Month + Var_t1 + Var_t2, data = brent_2020)

# Afficher le résumé du modèle
summary(model)

# Ajouter les prédictions pour chaque segment dans les données
brent_2020 <- brent_2020 %>%
  mutate(
    Predicted_Brent = predict(model)  
  )


# Graphique avec les segments de régression
ggplot(brent_2020, aes(x = Mois, y = Moyenne_Brent)) +
  geom_line(color = "steelblue", size = 1) +
  geom_smooth(method = "loess", color = "red", size = 1, se = FALSE) +
  geom_line(aes(y = Predicted_Brent), color ="green4", size = 1) +
  geom_vline(xintercept = as.Date(c("2022-06-01", "2023-06-01")), linetype = "dashed", color = "black", size = 1) +
  labs(
    title = "Régression par morceaux avec ruptures en Juin 2022 et Juin 2023",
    x = "Date",
    y = "Moyenne mensuelle du Brent (USD)",
    subtitle = "source : Investing.com",
    caption = c("BUT Science des données - Lisieux", "Auteurs : Rasmata, Romain, Courteney,Sidy")
  ) +
  scale_x_date(
    breaks = seq(from = as.Date("2020-06-01"), 
                 to = max(brent_2020$Mois), 
                 by = "6 months"),
    date_labels = "%B %Y",
    name = "Mois de l'année"
  ) +
  theme_minimal() +
  theme(
    panel.grid.minor = element_blank(),
    plot.caption = element_text(hjust = c(0,1), size = 10, face = "bold", color = "black"),
    plot.subtitle = element_text(size = 12, color = "darkblue", hjust = 0.5),
    plot.title = element_text(hjust = 0.5, face = "bold")
  )
```

L'analyse des variations mensuelles moyennes de la cotation du Brent depuis le 1er janvier 2010 révèle des fluctuations notables, notamment en juin 2022 et juin 2023. Ces ruptures structurelles ont été intégrées dans le modèle de régression par morceaux à l'aide des variables explicatives `Var_t1` et `Var_t2`, segmentant ainsi la période d'observation en trois intervalles distincts :

 

- **Période 1 : Avant juin 2022**

- **Période 2 : Entre juin 2022 et juin 2023**

- **Période 3 : Après juin 2023**

 

Le modèle de régression par morceaux, intégrant ces variables, est formulé comme suit :

 

\[ \text{Moyenne\_Brent} = \beta_0 + \beta_1 \cdot \text{Year\_Month} + \beta_2 \cdot \text{Var\_t1} + \beta_3 \cdot \text{Var\_t2} + \varepsilon \]

 

avec les coefficients estimés :

 

- \( \beta_0 \) : Intercept (-60084.463)

- \( \beta_1 \) : Effet global du temps (+29.758)

- \( \beta_2 \) : Effet de la première rupture (-52.417)

- \( \beta_3 \) : Effet de la seconde rupture (+24.663)

 

Les équations spécifiques aux périodes sont donc les suivantes :

 

1. **Avant juin 2022** (\( \text{Var\_t1} = 0 \), \( \text{Var\_t2} = 0 \)) :

   \[ \text{Moyenne\_Brent} = -60084.463 + 29.758 \cdot \text{Year\_Month} \]

2. **Entre juin 2022 et juin 2023** (\( \text{Var\_t1} = 1 \), \( \text{Var\_t2} = 0 \)) :

   \[ \text{Moyenne\_Brent} = -60084.463 + 29.758 \cdot \text{Year\_Month} - 52.417 \]

3. **Après juin 2023** (\( \text{Var\_t1} = 1 \), \( \text{Var\_t2} = 1 \)) :

   \[ \text{Moyenne\_Brent} = -60084.463 + 29.758 \cdot \text{Year\_Month} - 52.417 + 24.663 \]

 

L'analyse des tendances révèle trois dynamiques distinctes :

 

1. **Avant juin 2022** :

   - Le coefficient \( \beta_1 = +29.758 \) indique une augmentation significative des prix du Brent au fil du temps, reflétant une forte croissance probablement liée à une augmentation de la demande mondiale et à des contraintes d'approvisionnement.

2. **Entre juin 2022 et juin 2023** :

   - L'ajout de \( \beta_2 = -52.417 \) réduit drastiquement la tendance croissante, suggérant un choc externe, tel que des déséquilibres économiques, des décisions géopolitiques ou des politiques énergétiques, ayant entraîné une baisse notable des prix.

3. **Après juin 2023** :

   - L'ajout de \( \beta_3 = +24.663 \) compense en partie l'effet négatif de \( \beta_2 \), indiquant une reprise des prix, bien que la tendance croissante reste modérée par rapport à la période précédente.

 

En conclusion, ce modèle par morceaux s'avère pertinent pour expliquer les variations des prix du Brent en présence de ruptures structurelles. La capacité explicative élevée (R² ajusté de 82,2 %) confirme que ce modèle s'adapte bien aux fluctuations observées, offrant ainsi une compréhension approfondie des dynamiques du marché pétrolier au cours de la période étudiée.


\newpage

```{r analyse_brent_5, results='hide'}
#5.
# Créer les dates pour les 26 prochains mois
future_dates <- seq(from = max(brent_2020$Mois) + months(1), 
                    by = "month", length.out = 26)

#  Créer un nouveau dataframe avec ces dates futures
future_data <- data.frame(Mois = future_dates)
future_data$Year_Month <- as.numeric(format(future_data$Mois, "%Y")) + as.numeric(format(future_data$Mois, "%m")) / 12
future_data$Var_t1 <- pmax(0, future_data$Year_Month - t1)
future_data$Var_t2 <- pmax(0, future_data$Year_Month - t2)

#  Faire la prédiction pour les 26 prochains mois avec l'intervalle de prédiction
future_predictions <- predict(model, newdata = future_data, interval = "prediction")

# Ajouter les prévisions et les intervalles dans le dataframe
future_data$Predicted_Brent <- future_predictions[, "fit"]
future_data$Lower_Brent <- future_predictions[, "lwr"]
future_data$Upper_Brent <- future_predictions[, "upr"]

# Visualiser avec la courbe et la bande de confiance
ggplot() +
  geom_line(data = brent_2020, aes(x = Mois, y = Moyenne_Brent), color = "steelblue", size = 1) +
    geom_smooth(data = brent_2020, aes(x = Mois, y = Moyenne_Brent), method = "loess", color = "red", size = 1, se = FALSE) +
  geom_line(data = future_data, aes(x = Mois, y = Predicted_Brent), color = "darkgreen", size = 1) +
  geom_ribbon(data = future_data, aes(x = Mois, ymin = Lower_Brent, ymax = Upper_Brent), fill = "chocolate3", alpha = 0.2) +
  geom_line(data = future_data, aes(x = Mois, y = Upper_Brent), color = "black", linetype = "dashed", size = 0.3) +
  geom_line(data = future_data, aes(x = Mois, y = Lower_Brent), color = "black", linetype = "dashed", size = 0.3) +
  labs(
    title = "Prévision des moyennes mensuelles de la cotation du Brent avec bande de confiance à 95%",
    x = "Date",
    y = "Moyenne mensuelle du Brent (USD)",
    subtitle = "source : Investing.com",
    caption = c("BUT Science des données - Lisieux", "Auteurs : Rasmata, Romain, Courteney,Sidy")
  ) +
  scale_x_date(
    breaks = seq(from = as.Date("2020-01-01"), to = max(future_data$Mois), by = "1 year"),
    date_labels = "%B %Y", 
    name = "Mois de l'année"
  ) +
  theme_minimal()+
  theme(
    panel.grid.minor = element_blank(),
    plot.caption = element_text(hjust = c(0,1), size = 10, face = "bold", color = "black"),
    plot.subtitle = element_text(size = 12, color = "darkblue", hjust = 0.5),
    plot.title = element_text(hjust = 0.5, face = "bold")
  )
```

Le graphique présente la prévision des prix du Brent pour les 26 prochains mois, avec une bande de confiance à 95 %. La courbe de prévision centrale montre une légère tendance croissante, suggérant une possible stabilisation et une reprise progressive des prix du Brent à long terme. Cela indique que, selon le modèle, les fluctuations majeures observées entre 2020 et 2023 ne sont pas anticipées dans les 26 mois suivants, sauf en cas de perturbations majeures. À mesure que la période prévisionnelle s'éloigne, la bande de confiance s'élargit, ce qui reflète une incertitude croissante sur la précision des prévisions, une caractéristique typique des modèles de prévision à long terme. La zone de prévision inclut des tendances similaires à celles observées dans les données passées, et les fluctuations des prix semblent bien capturées par le modèle. La bande de confiance symétrique indique que le modèle prévoit une plage raisonnable de fluctuations, sans déséquilibres extrêmes à la hausse ou à la baisse. Ces prévisions peuvent être utiles pour des analyses économiques, des stratégies d'investissement ou des projections budgétaires, particulièrement pour les entreprises dépendant du marché du pétrole. Toutefois, il est important de noter que le modèle ne prend pas en compte des chocs externes éventuels (par exemple, des crises géopolitiques, climatiques ou technologiques) et que les valeurs en dehors de la bande de confiance (5 % des cas) peuvent résulter de facteurs imprévus non modélisés. En conclusion, bien que les prévisions restent relativement stables dans la plage prédite, l'élargissement de la bande de confiance montre une incertitude croissante à long terme. Pour améliorer la robustesse des prévisions, il serait utile d'incorporer des variables supplémentaires liées aux facteurs économiques mondiaux ou aux événements spécifiques du marché pétrolier.

 **Conclusion de l'analyse du Brent**



L'analyse des cotations du Brent révèle des dynamiques complexes influencées par des facteurs géopolitiques, économiques mondiaux et des ruptures structurelles. Depuis 2010, les prix ont traversé des périodes de forte croissance, suivies de chutes abruptes et de stabilisation. Les périodes de hausse, notamment entre 2021 et 2023, ont été alimentées par la reprise économique post-COVID et des tensions géopolitiques, tandis que la pandémie et des événements comme la guerre en Ukraine ont provoqué des baisses notables. Les modèles de régression montrent des ruptures structurelles, avec des phases de croissance et de baisse en fonction des événements externes. La prévision à long terme suggère une stabilisation progressive des prix, bien que l'incertitude demeure, soulignant la volatilité du marché pétrolier. Ainsi, bien que le marché semble se normaliser, il reste sensible aux chocs exogènes, et une attention particulière doit être portée aux facteurs externes pour mieux comprendre l'évolution future des prix du Brent.


\newpage
# Conclusion

### Conclusion générale du projet

L'analyse des cotations des matières premières sur différentes périodes et sous divers angles met en évidence des dynamiques distinctes influencées par des facteurs géopolitiques, climatiques et économiques mondiaux. Les principales matières premières étudiées (cacao, café, jus d'orange, pétrole et sucre) révèlent des comportements complexes, où les tendances générales de hausse des prix, observées particulièrement après 2020, semblent être liées aux perturbations mondiales causées par la pandémie de COVID-19, les crises géopolitiques, et les conditions climatiques extrêmes.

Le cacao, bien qu'initialement stable, a vu ses prix augmenter de manière significative à partir de 2020, conséquence de crises géopolitiques et de phénomènes climatiques affectant les grands pays producteurs. De même, le café a connu une volatilité accrue en raison de chocs d'offre dus aux conditions climatiques et à la pandémie. Le jus d'orange a subi une pression haussière liée à des facteurs climatiques et à des perturbations dans la chaîne d'approvisionnement, tandis que les cotations du pétrole ont été fortement influencées par des crises géopolitiques, avec des pics en 2011 et 2022. Le sucre a montré une trajectoire plus stable, bien qu'il ait été affecté par les crises économiques et la pandémie.

Une caractéristique commune à toutes ces matières premières est la forte volatilité des prix, particulièrement visible pendant et après la pandémie. Les analyses des variations mensuelles et des taux d’évolution confirment l'importance de ces facteurs mondiaux dans la dynamique des prix.

Le marché du Brent, quant à lui, a été marqué par de fortes fluctuations dues à des chocs géopolitiques et à l'offre, avec une tendance générale à l’instabilité mais avec des signes de stabilisation à partir de 2023. La saisonnalité, souvent observée dans d'autres marchés, n'est pas apparue sur le marché du Brent, ce qui témoigne de l'importance de facteurs externes dans la détermination des prix du pétrole.

En conclusion, ce projet démontre que les matières premières sont profondément influencées par une combinaison de facteurs externes complexes, où les tendances à long terme sont marquées par des événements ponctuels de grande envergure, notamment les crises économiques, les catastrophes climatiques et les tensions géopolitiques. Les analyses statistiques et les modélisations des prix de ces matières premières permettent de mieux comprendre leur évolution et les risques associés, tout en mettant en évidence la nécessité pour les acteurs du marché de s'adapter aux changements rapides et souvent imprévisibles.

\newpage

# Annexe

## Investing.com

Investing.com est une plateforme financière qui fournit des informations et des analyses sur les marchés financiers mondiaux. Elle propose des données en temps réel, des graphiques, des outils financiers, des nouvelles et des analyses pour divers actifs financiers, y compris les actions, les devises, les matières premières et les indices. Les données que nous avons utilisées dans le cadre de ce projet proviennent de cette plateforme.

\begin{figure}[!h] 
   \centering
    \href{https://www.investing.com}{\includegraphics[scale = 1]{Images/premier.png}}
    \caption{Logo de Investing.com}
\end{figure}

\begin{figure}[!h] 
   \centering
    \includegraphics[scale = 1]{Images/Extrait_site_investing.png}
    \caption{Extrait du site où sont les données d'origine}
\end{figure}

\newpage

# TABLE DES FIGURES 
\listoffigures